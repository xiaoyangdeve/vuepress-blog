<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>时间序列短期预测分析初探 | 不爱吃鱼的bobo</title>
    <meta name="generator" content="VuePress 1.9.8">
    
    <meta name="description" content="不爱吃鱼的bobo的数据学习小记录">
    
    <link rel="preload" href="/vuepress-blog/assets/css/0.styles.e16f7ba9.css" as="style"><link rel="preload" href="/vuepress-blog/assets/js/app.4bc7db6f.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/3.7135f1dd.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/1.9ca1bed4.js" as="script"><link rel="preload" href="/vuepress-blog/assets/js/7.814d63f2.js" as="script"><link rel="prefetch" href="/vuepress-blog/assets/js/10.8185cf85.js"><link rel="prefetch" href="/vuepress-blog/assets/js/11.e2683902.js"><link rel="prefetch" href="/vuepress-blog/assets/js/12.2867d00d.js"><link rel="prefetch" href="/vuepress-blog/assets/js/4.a4c6b4de.js"><link rel="prefetch" href="/vuepress-blog/assets/js/5.2493db42.js"><link rel="prefetch" href="/vuepress-blog/assets/js/6.b79b79b0.js"><link rel="prefetch" href="/vuepress-blog/assets/js/8.0f9ffa04.js"><link rel="prefetch" href="/vuepress-blog/assets/js/9.fad48aa9.js">
    <link rel="stylesheet" href="/vuepress-blog/assets/css/0.styles.e16f7ba9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>不爱吃鱼的bobo</h3> <p class="description" data-v-59e6cb88>不爱吃鱼的bobo的数据学习小记录</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-blog/" class="home-link router-link-active"><!----> <span class="site-name">不爱吃鱼的bobo</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      大数据组件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Kafka
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  数据分析
</a></div><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  语言
</a></div><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  数据结构与算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      数据湖
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Iceberg
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Hudi
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Delta
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      A/B测试
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/posts/AB-Test/AB测试的理论基础.html" class="nav-link"><i class="undefined"></i>
  A/B测试的理论基础
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  怎样进行A/B测试
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  怎样在A/B测试中避免踩坑
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      用户画像
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  怎样做OneID
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  用户标签计算
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  人群圈选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Github
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  掘金
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>3</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>3</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      大数据组件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Spark
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Flink
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Kafka
</a></li></ul></div></div><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  数据分析
</a></div><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  语言
</a></div><div class="nav-item"><a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  数据结构与算法
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      数据湖
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Iceberg
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Hudi
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Delta
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      A/B测试
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/posts/AB-Test/AB测试的理论基础.html" class="nav-link"><i class="undefined"></i>
  A/B测试的理论基础
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  怎样进行A/B测试
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  怎样在A/B测试中避免踩坑
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      用户画像
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  怎样做OneID
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  用户标签计算
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  人群圈选
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  Github
</a></li><li class="dropdown-item"><!----> <a href="/vuepress-blog/" class="nav-link"><i class="undefined"></i>
  掘金
</a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/vuepress-blog/" class="sidebar-heading clickable router-link-active open"><span>学前</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-blog/posts/data_analysis/时间序列短期预测分析初探.html" class="active sidebar-link">时间序列</a></li><li><a href="/vuepress-blog/posts/AB-Test/AB测试的理论基础.html" class="sidebar-link">AB测试是什么</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>时间序列短期预测分析初探</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <!---->
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">时间序列短期预测分析初探</h1> <div data-v-8a445198><!----> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>12/3/2019</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>时间序列</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_1-时间序列介绍"><a href="#_1-时间序列介绍" class="header-anchor">#</a> 1.时间序列介绍</h2> <p><strong>时间序列</strong>（英语：time series）是一组按照时间发生先后顺序进行排列的数据点。通常一组时间序列的时间间隔为一恒定值（如1秒，5分钟，12小时，7天，1年，股票每天的收盘价等），因此时间序列可以作为离散时间数据进行分析处理。</p> <h3 id="时间序列变量的特征"><a href="#时间序列变量的特征" class="header-anchor">#</a> 时间序列变量的特征</h3> <ul><li><strong>非平稳性</strong>（nonstationarity，也译作<strong>不平稳性</strong>，<strong>非稳定性</strong>）：即时间序列的方差无法呈现出一个长期趋势并最终趋于一个常数或是一个线性函数</li> <li>波动幅度<strong>随时间变化</strong>（Time－varying Volatility）：即一个时间序列变量的方差随时间的变化而变化</li></ul> <p>这两个特征使得有效分析时间序列变量十分困难。</p> <p>平稳型时间数列（Stationary Time Series）系指一个时间数列其统计特性将不随时间之变化而改变者。</p> <p><img src="/vuepress-blog/assets/img/white_notise.ed89710e.png" alt="白噪声"><img src="/vuepress-blog/assets/img/random_walk.bdf7582e.png" alt="随机游走"></p> <center>前者白噪声序列是常见的平稳序列，后者随即游走是分平稳序列。</center>
时间序列数据变动存在着规律性与不规律性
<p>时间序列中的每个观察值大小,是影响变化的各种不同因素在同一时刻发生作用的综合结果。从这些影响因素发生作用的大小和方向变化的时间特性来看,这些因素造成的时间序列数据的变动分为四种类型。</p> <ol><li><p>趋势性(T):某个变量随着时间进展或自变量变化,呈现一种比较缓慢而长期的持续上升、下降、停留的同性质变动趋向,但变动幅度可能不相等。</p></li> <li><p>周期性(S):某因素由于外部影响随着自然季节的交替出现高峰与低谷的规律。</p></li> <li><p>随机性(R):个别为随机变动,整体呈统计规律。</p></li> <li><p>综合性:实际变化情况是几种变动的叠加或组合。预测时设法过滤除去不规则变动,突出反映趋势性和周期性变动</p></li></ol> <p>从实际的序列中把各个变动的部分分离出来是对时间序列分析的首要任务，将分离得到的部分进行分析后再通过函数的变化实现 对总体序列的分析</p> <h3 id="时间序列的平稳化"><a href="#时间序列的平稳化" class="header-anchor">#</a> 时间序列的平稳化</h3> <p>在熟悉了平稳性的概念及其不同的类型之后，接下来可以对序列进行平稳化操作。请记住，为了建立时间序列预测模型，必须首先将任何非平稳序列转换为平稳序列。常用于平稳化的手段有以下一些：</p> <ul><li>差分化</li> <li>季节性差分</li> <li>变换：幂变换、平方根变换、对数变换</li></ul> <h2 id="_2-短期预测"><a href="#_2-短期预测" class="header-anchor">#</a> 2.短期预测</h2> <p>在金勇老师的建议下，选择了日活、日总使用时长、日人均使用时长三份样本数据进行建模分析。同时使用Python构建三个不同的模型，并检查其结果。</p> <ul><li>ARIMA：差分整合移动平均自回归模型</li> <li>LSTM：长短期记忆神经网络</li> <li>Facebook Prophet：Facebook公司开源的时间序列预测库的</li></ul> <h3 id="arima"><a href="#arima" class="header-anchor">#</a> ARIMA</h3> <p>ARIMA是一个用于预测未来趋势的时间序列数据模型。模型是回归分析的一种形式。</p> <ul><li>AR（Autoregression）：显示变量变化的模型，该变量在其自身的滞后/先验值上回归。</li> <li>I（Integrated）：差分时间序列的原始观测数据,使其平稳</li> <li>MA（Moving average）：观察值与移动平均模型的残差之间的依赖关系</li></ul> <p>对于ARIMA模型，标准的表示法是带有p、d和q的ARIMA，其中整数值替代参数来表示所使用的ARIMA模型的类型。</p> <ul><li>p：自回归阶数</li> <li>d：差分次数</li> <li>q：移动平均阶数</li></ul> <h3 id="lstm神经网路"><a href="#lstm神经网路" class="header-anchor">#</a> LSTM神经网路</h3> <p>LSTM是RNN的一种特殊类型，可以学习长期依赖信息，将长期记忆引入循环神经网络，缓解了梯度消失问题。它通过一系列“门”（Input Gate、Output Gate、Forget Gate）来实现这一点。</p> <h3 id="prophet"><a href="#prophet" class="header-anchor">#</a> Prophet</h3> <p>Prophet是一种基于加法模型预测时间序列数据的过程，其中非线性趋势与年、周、日季节性以及假日效应相吻合。它最适用于具有强烈季节效应和几个季节的历史数据的时间序列。Prophet对缺失的数据和趋势的变化是健壮的，通常能很好地处理异常值。</p> <p>下图为使用同一份日活数据用以上三种方式简单建模，预测了未来30天的数据与实际值的对比。</p> <p><img src="/vuepress-blog/assets/img/compare_lstm_arima_prophet.b87b7682.png" alt="image-20191205152416970"></p> <p>通过对比可以看出prophet的预测更接近实际值一些，下面将使用prophet对三份样本进行建模和预测。主要步骤有：</p> <ul><li>1、读取数据，对数据进行平稳性检查，并根据结果进行差分和移动平均及对数化</li> <li>2、添加模型参数、假日因子，建立模型并进行短期预测</li> <li>3、对预测结果进行检查评估</li></ul> <p>附主要部分代码：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">build_model_predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>
                        input_df<span class="token punctuation">,</span>
                        cap<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        floor<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                        period<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> holidays_country<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> freq<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
        构建模型 预测
        :parameter input_df 模型输入数据
        :parameter holidays: 假日df
        :parameter holidays_country: 需要添加的假日国家
        :parameter cap: logistic上限容量
        :parameter floor: logistic下限容量
        :parameter period: 预测天数
        :parameter freq 频率，默认D

        :return forecast
    &quot;&quot;&quot;</span>

    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'开始prophet建模预测{growth=%s, seasonality_model=%s, cap_threshold=%.4f}'</span> <span class="token operator">%</span>
                <span class="token punctuation">(</span>self<span class="token punctuation">.</span>growth<span class="token punctuation">,</span> self<span class="token punctuation">.</span>seasonality_model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>cap_threshold<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 构建模型</span>
    m <span class="token operator">=</span> Prophet<span class="token punctuation">(</span><span class="token punctuation">)</span>
    m<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>input_df<span class="token punctuation">)</span>
    future <span class="token operator">=</span> m<span class="token punctuation">.</span>make_future_dataframe<span class="token punctuation">(</span>period<span class="token punctuation">,</span> freq<span class="token operator">=</span>freq<span class="token punctuation">)</span>

    <span class="token comment"># 构建预测模型</span>
    predict_model <span class="token operator">=</span> Prophet<span class="token punctuation">(</span>
        holidays<span class="token operator">=</span>self<span class="token punctuation">.</span>holidays<span class="token punctuation">,</span>
        seasonality_mode<span class="token operator">=</span>self<span class="token punctuation">.</span>seasonality_model<span class="token punctuation">,</span>
        growth<span class="token operator">=</span>self<span class="token punctuation">.</span>growth
    <span class="token punctuation">)</span>
    <span class="token comment"># 添加假日</span>
    <span class="token keyword">if</span> holidays_country <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        predict_model<span class="token punctuation">.</span>add_country_holidays<span class="token punctuation">(</span>country_name<span class="token operator">=</span>holidays_country<span class="token punctuation">)</span>

    <span class="token comment"># 设定序列上下容量</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>growth <span class="token operator">==</span> <span class="token string">'logistic'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cap <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            cap <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>input_df<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>cap_threshold
        <span class="token keyword">if</span> floor <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            y_min <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>input_df<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            cap_threshold_inner <span class="token operator">=</span> self<span class="token punctuation">.</span>cap_threshold
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>cap_threshold <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                cap_threshold_inner <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>cap_threshold
            <span class="token keyword">if</span> y_min <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                floor <span class="token operator">=</span> y_min <span class="token operator">*</span> cap_threshold_inner
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                floor <span class="token operator">=</span> y_min <span class="token operator">/</span> cap_threshold_inner
        input_df<span class="token punctuation">[</span><span class="token string">'cap'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cap
        input_df<span class="token punctuation">[</span><span class="token string">'floor'</span><span class="token punctuation">]</span> <span class="token operator">=</span> floor
        future<span class="token punctuation">[</span><span class="token string">'cap'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cap
        future<span class="token punctuation">[</span><span class="token string">'floor'</span><span class="token punctuation">]</span> <span class="token operator">=</span> floor
    <span class="token comment"># 模型拟合及预测</span>
    forecast <span class="token operator">=</span> predict_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>input_df<span class="token punctuation">)</span><span class="token punctuation">.</span>predict<span class="token punctuation">(</span>future<span class="token punctuation">)</span>
    <span class="token keyword">return</span> forecast
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">construct_model</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> csv_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取数据</span>
    df <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>gen_df_from_csv_file<span class="token punctuation">(</span>csv_path<span class="token punctuation">)</span>
    train_df<span class="token punctuation">,</span> test_df <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>df_split<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
    train_ts <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>df_to_ts<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> index_column<span class="token operator">=</span><span class="token string">'ds'</span><span class="token punctuation">,</span> val_column<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span>
    <span class="token comment"># 数据平稳性检查</span>
    debout <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>gen_test_stationarity<span class="token punctuation">(</span>train_ts<span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span>debout<span class="token punctuation">)</span>
    <span class="token keyword">if</span> debout<span class="token punctuation">[</span><span class="token string">'p-value'</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token number">0.001</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>log_flag <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>log_flag<span class="token punctuation">:</span>
        train_ts <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>ts_log<span class="token punctuation">(</span>train_ts<span class="token punctuation">)</span>
    <span class="token comment"># 移动平均和差分</span>
    train_ts_log_diff <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>diff_ts<span class="token punctuation">(</span>train_ts<span class="token punctuation">,</span> d<span class="token operator">=</span>self<span class="token punctuation">.</span>diff_list<span class="token punctuation">)</span>
    <span class="token comment"># 训练集转换为df</span>
    train_log_diff_df <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>ts_to_df<span class="token punctuation">(</span>train_ts_log_diff<span class="token punctuation">,</span> index_column<span class="token operator">=</span><span class="token string">'ds'</span><span class="token punctuation">,</span> val_column<span class="token operator">=</span><span class="token string">'y'</span><span class="token punctuation">)</span>
    <span class="token comment"># 调用模型进行训练</span>
    self<span class="token punctuation">.</span>gen_holidays<span class="token punctuation">(</span><span class="token punctuation">)</span>
    forecast <span class="token operator">=</span> self<span class="token punctuation">.</span>build_model_predict<span class="token punctuation">(</span>train_log_diff_df<span class="token punctuation">,</span>
                                        period<span class="token operator">=</span><span class="token number">30</span>
                                        <span class="token punctuation">)</span>
    forecast_ts <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>df_to_ts<span class="token punctuation">(</span>forecast<span class="token punctuation">,</span> val_column<span class="token operator">=</span><span class="token string">'yhat'</span><span class="token punctuation">)</span>
    forecast_diff_reduction <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>predict_diff_recover<span class="token punctuation">(</span>forecast_ts<span class="token punctuation">,</span> d<span class="token operator">=</span>self<span class="token punctuation">.</span>diff_list<span class="token punctuation">)</span>
    <span class="token keyword">if</span> self<span class="token punctuation">.</span>log_flag<span class="token punctuation">:</span>
        forecast_diff_reduction <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>ts_log_reduction<span class="token punctuation">(</span>forecast_diff_reduction<span class="token punctuation">)</span>
    forecast_df <span class="token operator">=</span> ProphetUtils<span class="token punctuation">.</span>ts_to_df<span class="token punctuation">(</span>forecast_diff_reduction<span class="token punctuation">,</span> val_column<span class="token operator">=</span><span class="token string">'yhat'</span><span class="token punctuation">)</span>

    df_final <span class="token operator">=</span> self<span class="token punctuation">.</span>model_accuracy_calculate<span class="token punctuation">(</span>forecast<span class="token operator">=</span>forecast_df<span class="token punctuation">,</span> df_test<span class="token operator">=</span>test_df<span class="token punctuation">)</span>
    logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'test_data样本准确率：min=%.4f, max=%.4f, mean=%.4f, median=%.4f'</span> <span class="token operator">%</span>
                <span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>df_final<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>df_final<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                 np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>df_final<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>median<span class="token punctuation">(</span>df_final<span class="token punctuation">[</span><span class="token string">'rate'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
    <span class="token keyword">return</span> df_final
</code></pre></div><p>预测表现结果如下</p> <p><img src="/vuepress-blog/assets/img/predict_result.3b5c6d27.png" alt="image-20191205152416970"></p> <p>样本数据为2018-01-01～2019-09-20这段时间的数据，使用fbprophet建模，经过一些优化和因子改变后，预测2019-09-21～2019-10-20的值，由于图片原因只展示了最后七天的数据，其中中位数和均值根据预测30日的结果计算得到。</p> <h2 id="_3-后续的优化"><a href="#_3-后续的优化" class="header-anchor">#</a> 3.后续的优化</h2> <ul><li>在对法定节假日进行预测时，待数据丰富后对法定节假日进行分离，分开建模预测，以提高其预测准确率。</li> <li>经过产品及技术方案的评审后，将短期预测与监控工具进行结合，对每日的实际值和预测值进行对比监控。</li> <li>与BI看板相结合，对于预测值以虚线展示，提高数据利用的宽度和深度。</li></ul> <h2 id="附录-随机序列与时间序列"><a href="#附录-随机序列与时间序列" class="header-anchor">#</a> 附录-随机序列与时间序列</h2> <h3 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h3> <p>首先介绍一下期望的性质</p> <p>​		 1、设Y_t 是随机变量，c为常数，则Ε(cY_t )=cΕ(Y_t )</p> <p>​		 2、设Y_t和Y_s是两个随机变量，则Ε(Y_t+Y_s )=Ε(Y_t )+Ε(Y_s )</p> <p>​         3、设Y_t和Y_s是两个相互独立的随机变量，则Ε(Y_t Y_s )=Ε(Y_t )Ε(Y_s )</p> <p>​	然后我们给定随机序列：{Y_t}={Y_t:t=0,±1,±2,±3,…}，那么它的均值函数就是它的期望，记作μ_t，方差就是随机变量Yt与它的均值函数的差值作平方，之后求期望，这里的Var就是variance。</p> <p><img src="/vuepress-blog/assets/img/gongshi01.b1b0000a.png" alt="image-20191205152416970"></p> <p>​	结合期望的性质可以得出一个重要的结论：</p> <p><img src="/vuepress-blog/assets/img/gongshi02.b1426b44.png" alt="image-20191205152416970"></p> <p>​	和的协方差就可以展开为协方差的和，当<img src="data:image/png;base64,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" alt="image-20191205152416970"> 相同的时候，协方差就可以变成方差，所以就给出了一个特别的情况：</p> <div class="language- extra-class"><pre><code>也就是说，随机变量的和的方差可以展开称随机变量的方差求和再加上任何两个随机变量的协方差求和，这两个结论在计算不同的时间序列的时候会用到，可以根据期望的性质推导得到。
</code></pre></div><h3 id="平稳性"><a href="#平稳性" class="header-anchor">#</a> 平稳性</h3> <p><img src="/vuepress-blog/assets/img/gongshi04.a5f7e5c5.png" alt="image-20191205152416970"></p> <p>严平稳性只是要求了联合分布相同，但是并不代表随机变量Yt一定存在一阶炬和二阶矩函数。</p> <div class="language- extra-class"><pre><code>当n=1，其实代表Y_(t_1 )和Y_(t_1-k)的联合分布相同，Y是具有相同边际分布，如果此时Y存在着一阶矩和二阶矩，那么对于任何的t和k，Y的均值和方差函数恒定为常数。

当n=2时，其实Y_(t_1 ),Y_(t_2 )与Y_(t_1-k),Y_(t_2-k)的联合分布相同，其实就是二元分布相同，如果存在二阶矩，Y的协方差的只依赖于时间间隔
</code></pre></div><p>​	如果该随机过程的均值、方差是与时间t无关的常数，协方差是只与时间间隔k有关，与时间t无关的常数，则称该随机过程而生成的时间序列是<strong>弱平稳</strong>的。</p> <p>​	常见的如白噪声的过程是平稳的，因为它的均值是0，方差为常数s^2，所有时间间隔的协方差均为零。但随机游走时非平稳的，尽管它的均值为常数，但方差是与t相关的非常数，不过，若令DXt=Xt-Xt-1，则随机游走过程的一阶差分（first difference）是平稳的。</p> <p>​	样本时间序列展现了随机变量的历史和现状，因此所谓随机变量基本性态的维持不变也就是要求样本数据时间序列的本质特征仍能延续到未来。我们用样本时间序列的均值、方差、协（自）方差来刻画该样本时间序列的本质特征。于是，我们称这些统计量的取值在未来仍能保持不变的样本时间序列具有平稳性。可见，一个平稳的时间序列指的是：遥想未来所能获得的样本时间序列，我们能断定其均值、方差、协方差必定与眼下已获得的样本时间序列等同。相反，如果样本时间序列的本质特征只存在于所发生的当期，并不会延续到未来，亦即样本时间序列的均值、方差、协方差非常数，则这样一个过于独特的时间序列不足以昭示未来，我们便称这样的样本时间序列是非平稳的。形象地理解，平稳性就是要求经由样本时间序列所得到的拟合曲线在未来的一段期间内仍能顺着现有的形态“惯性”地延续下去；如果数据非平稳，则说明样本拟合曲线的形态不具有“惯性”延续的特点，也就是基于未来将要获得的样本时间序列所拟合出来的曲线将迥异于当前的样本拟合曲线。可见，时间序列平稳是经典回归分析赖以实施的基本假设；只有基于平稳时间序列的预测才是有效的。如果数据非平稳，则作为大样本下统计推断基础的“一致性”要求便被破坏，基于非平稳时间序列的预测也就失效。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ol><li><a href="https://facebook.github.io/prophet/docs/quick_start.html#python-api" target="_blank" rel="noopener noreferrer">Prophet官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zh.wikipedia.org/zh-hans/%E6%99%82%E9%96%93%E5%BA%8F%E5%88%97" target="_blank" rel="noopener noreferrer">维基百科-时间序列<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.ancii.com/axy3epmjp/" target="_blank" rel="noopener noreferrer">时间序列预测<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ol></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vuepress-blog/posts/AB-Test/AB测试的理论基础.html">
          AB测试是什么
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#_1-时间序列介绍" class="sidebar-link reco-side-_1-时间序列介绍" data-v-b57cc07c>1.时间序列介绍</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#时间序列变量的特征" class="sidebar-link reco-side-时间序列变量的特征" data-v-b57cc07c>时间序列变量的特征</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#时间序列的平稳化" class="sidebar-link reco-side-时间序列的平稳化" data-v-b57cc07c>时间序列的平稳化</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#_2-短期预测" class="sidebar-link reco-side-_2-短期预测" data-v-b57cc07c>2.短期预测</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#arima" class="sidebar-link reco-side-arima" data-v-b57cc07c>ARIMA</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#lstm神经网路" class="sidebar-link reco-side-lstm神经网路" data-v-b57cc07c>LSTM神经网路</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#prophet" class="sidebar-link reco-side-prophet" data-v-b57cc07c>Prophet</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#_3-后续的优化" class="sidebar-link reco-side-_3-后续的优化" data-v-b57cc07c>3.后续的优化</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#附录-随机序列与时间序列" class="sidebar-link reco-side-附录-随机序列与时间序列" data-v-b57cc07c>附录-随机序列与时间序列</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#基本概念" class="sidebar-link reco-side-基本概念" data-v-b57cc07c>基本概念</a></li><li class="level-3" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#平稳性" class="sidebar-link reco-side-平稳性" data-v-b57cc07c>平稳性</a></li><li class="level-2" data-v-b57cc07c><a href="/vuepress-blog/posts/data_analysis/%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E7%9F%AD%E6%9C%9F%E9%A2%84%E6%B5%8B%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2.html#参考资料" class="sidebar-link reco-side-参考资料" data-v-b57cc07c>参考资料</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/vuepress-blog/assets/js/app.4bc7db6f.js" defer></script><script src="/vuepress-blog/assets/js/3.7135f1dd.js" defer></script><script src="/vuepress-blog/assets/js/1.9ca1bed4.js" defer></script><script src="/vuepress-blog/assets/js/7.814d63f2.js" defer></script>
  </body>
</html>
